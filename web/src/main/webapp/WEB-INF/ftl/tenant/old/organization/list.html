<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>组织管理</title>
	<!-- Tell the browser to be responsive to screen width -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<!-- Bootstrap 3.3.6 -->
	<link rel="stylesheet" href="${siteurl}bootstrap/css/bootstrap.min.css">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="${siteurl}plugins/FontAwesome/css/font-awesome.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="${siteurl}plugins/ionicons201/css/ionicons.min.css">
	<!-- Theme style -->
	<link rel="stylesheet" href="${siteurl}dist/css/AdminLTE.min.css">
	<!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
	<link rel="stylesheet" href="${siteurl}dist/css/skins/_all-skins.min.css">



	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
	[#include "/admin/common/commons.html"]

	<!--tree -->
	<link href="${siteurl}plugins/zTree_v3/css/zTreeStyle/zTreeStyle.css" rel="stylesheet">
	<link rel="stylesheet" href="${siteurl}plugins/vue-element/element.css">
</head>
<style>
	.content-header {
		padding: 0;
	}

	.content {
		padding: 0 10px 10px;
		background-color: #f9f9f9;
	}

	ul {
		padding: 0;
		margin: 0;
		list-style: none;
	}

	[v-cloak] {
		display: none;
	}

	/* 导航 */
	.navigation {
		height: 60px;
		line-height: 60px;
		background-color: #f9f9f9;
		padding-left: 10px;
	}

	.navigation i {
		color: #d9dee5;
		display: inline-block;
		font-size: 14px;
		color: #666666;
		font-style: normal;
	}

	.navigation i::after {
		content: '/';
		display: inline-block;
		margin: 0 5px;
	}

	.navigation span {
		font-weight: 700;
		font-size: 14px;
		color: #666666;
	}

	/* 商品资料 */
	.goods {
		background-color: #fff;
		padding: 10px 15px;
		overflow: auto;
	}

	/* 搜索 */
	.search {
		height: 58px;
		background-color: #f9f9f9;
		padding: 16px 0px 3px;
		box-sizing: border-box;
	}

	.goodsChoose input {
		border-right: 0 !important;
	}

	/* tab切换 */
	.tab .el-menu--horizontal>.el-menu-item {
		height: 36px;
		line-height: 36px;
	}

	/* 商品内容 */
	.goods_content {
		height: 100%;
	}

	.goods_content_l {
		background-color: #f9f9f9;
		height: 100%;
		overflow: auto;
	}

	.goods_content_l .el-tree {
		background-color: transparent;
	}

	.goods_content_l .el-tree .el-tree-node__label {
		font-size: 13px;
		font-weight: bold;
	}

	.goods_content_l .el-tree-node {
		margin: 5px 0;
	}

	.goods_content_l .el-tree-node__content:hover {
		background-color: #f9f9f9;
	}

	.add_goods {
		padding: 10px 0 5px 0;
	}

	.goodsInfo {
		overflow: hidden;
		display: flex;
		align-items: center;
	}

	.goodsInfo img {
		width: 50px;
		height: 50px;
		margin-right: 5px;
		background-color: red;
	}

	.goodsInfo div {
		flex: 1;
		font-size: 12px;
    	line-height: 16px;
	}

	.goodsTitle {
		background: #5491de;
    	color: #fff;
		font-style: normal;
		border-radius: 2px;
		height: 14px;
		width: 14px;
		line-height: 14px;
		padding: 0;
		font-size: 12px;
		display: inline-block;
		text-align: center;
		margin-right: 4px;
	}

	.chlidrenGoodsList li {
		min-height: 64px;
		padding: 10px 0;
		display: flex;
		padding-left: 80px;
		border-bottom: 1px solid #f9f9f9;
	}

	.chlidrenGoodsList li div {
		align-items: center;
		display: flex;
	}

	.el-table--enable-row-transition .el-table__body td {
		padding: 10px 0 !important;
	}

	.more {
		margin-left: 10px;
	}

	.el-popover .item {
		font-size: 12px;
		color: #000;
		line-height: 20px;
		cursor: pointer;
	}

	.department {
		line-height: 40px;
	}

	.el-dialog__header {
		padding: 14px 16px;
		border-radius: 2px 2px 0 0;
		background: #fff;
		color: #666;
		border-bottom: 1px solid #e9e9e9;
	}

	.el-dialog__header .el-dialog__title {
		margin: 0;
		font-size: 14px;
		line-height: 21px;
		font-weight: bold;
	}

	.el-dialog__header .el-dialog__headerbtn {
		top: 14px;
	}

	.personnelUpload {
		width: 100%;
	}

	.personnelUpload .el-upload {
		width: 100%;
	}

	.personnelUpload .el-upload .el-upload-dragger {
		width: 100%;
	}

	.personnelUpload .el-upload .el-upload__input {
		display: none;
	}

	.el-tree-node__content {
		position: relative;
		line-height: 14px;
		padding: 0 10px !important;
	}

	.el-tree-node__content>label.el-checkbox {
		position: absolute;
		right: 15px;
	}

	.departmentDialog .el-row {
		height: 300px;
	}

	.departmentDialog .title {
		line-height: 18px;
		font-size: 13px;
		color: #9B9B9B;
		margin-bottom: 18px;
	}

	.departmentDialog li {
		display: flex;
		justify-content: space-between;
		align-items: center;
		font-size: 13px;
		color: #3C3C3C;
		line-height: 28px;
		padding: 0 2px;
		cursor: pointer;
	}

	.el-tree--highlight-current .el-tree-node.is-current>.el-tree-node__content {
		background-color: #2984EF;
		color: #fff;
	}

	.custom-tree-node i {
		position: absolute;
		right: 14px;
		display: none;
		overflow: hidden;
	}

	.el-tree--highlight-current .el-tree-node.is-current>.el-tree-node__content i {
		display: inline-block;
	}

	.page {
		text-align: right;
		margin: 10px 0;
	}
</style>

<body class="hold-transition skin-blue sidebar-mini">
	<!-- Site wrapper -->
	<div class="wrapper">

		<header class="main-header">
			<!-- Header Navbar: style can be found in header.less -->
			[#include "/admin/common/nav.html"]
		</header>

		<!-- =============================================== -->

		<!-- Left side column. contains the sidebar -->
		<aside class="main-sidebar">
			<!-- sidebar: style can be found in sidebar.less -->
			<section class="sidebar">
				[@user_panel /]
				<!-- search form -->
				[@sidebar_form /]
				<!-- /.search form -->
				<!-- sidebar menu: : style can be found in sidebar.less -->
				<ul class="sidebar-menu" data-widget="tree">
					<li class="header">主面板</li>
					[@menustag id=1]
					[#list list as item]
					[@menu item "1,117,118"]
					[/@menu]
					[/#list]
					[/@menustag]
				</ul>
			</section>
			<!-- /.sidebar -->
		</aside>

		<!-- =============================================== -->

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper" id="app" v-cloak>
			<!-- Content Header (Page header) -->
			<section class="content-header">
				<!-- 导航 -->
				<div class="navigation">
					<i>组织</i> <span>组织管理</span>
				</div>
			</section>
			<!-- Main content -->
			<section class="content">
				<!-- Default box -->
				<div class="goods">
					<!-- 商品 -->
					<div class="goods_content">
						<el-row style="height: 100%;">
							<el-col :span="4" class="goods_content_l">
								<el-tree :highlight-current="true" ref="tree" node-key='id' draggable :data="data" :props="defaultProps" @node-click="chooseDepartment">
									<span class="custom-tree-node" slot-scope="{ node, data }">
										<span>{{data.name}}</span>
										<el-popover
											class="more"
											placement="bottom"
											width="150"
											trigger="hover">
											<div class="item" @click="modifydepartment=true;modifydepartmentTitle='新建部门';">添加子部门</div>
											<div class="item" @click="modifydepartment=true;modifydepartmentTitle='编辑部门';">修改名称</div>
											<div class="item" @click="delectDepartment(data.id)">删除</div>
											<div class="item">部门ID：{{data.id}}</div>
											<i slot="reference" class="el-icon-more"></i>
										</el-popover>
									</span>
								</el-tree>
							</el-col>
							<el-col :span="20" style="padding-left: 15px;">
								<div class="department">
									<el-row>
										<el-col :span="20">
											纽百特· 4人
										</el-col>
										<el-col :span="4" style="text-align: right;color: #186FD5;cursor: pointer;">
											<span @click="modifydepartment=true;modifydepartmentTitle='编辑部门';">修改名称 · </span>
											<span @click="modifydepartment=true;modifydepartmentTitle='新建部门';">添加子部门</span>
										</el-col>
									</el-row>
								</div>
								<div class="add_goods">
									<el-button size="small" @click="addMember.state = true;addMember.title = '新增成员'">新增成员</el-button>
									<el-button size="small" @click="batchImport = true;">批量导入</el-button>
									<el-button size="small" @click="setUpDepartment">设置所在部门</el-button>
									<el-button size="small" @click="delectPersonnel">删除</el-button>
									<el-popover
										class="more"
										placement="bottom"
										width="150"
										trigger="click">
										<div class="item" @click="setUpDepartment">移入其他部门成员</div>
										<div class="item" @click="disablePersonnel">禁用</div>
										<div class="item" @click="enablePersonnel">启用</div>
										<div class="item" @click="enableSecurityLogin">启用安全登录</div>
										<el-button size="small" slot="reference">更多 <i class="el-icon-arrow-down"></i></el-button>
									</el-popover>
								</div>
								<el-table
								:data="tableData.list"
								@selection-change="handleSelectionChange"
								@row-click="modifyPersonnel"
								style="width: 100%;font-size: 12px;">
									<el-table-column
									type="selection"
									align="center"
									header-align="center"
									width="40">
									</el-table-column>
									<el-table-column
									label="姓名"
									width="200"
									:show-overflow-tooltip="true"
									prop="name">
									</el-table-column>
									<el-table-column
									width="200"
									label="职务"
									:show-overflow-tooltip="true"
									prop="job">
									</el-table-column>
									<el-table-column
									width="200"
									label="部门"
									:show-overflow-tooltip="true"
									prop="department">
									</el-table-column>
									<el-table-column
									width="200"
									label="手机"
									:show-overflow-tooltip="true"
									prop="phone">
									</el-table-column>
									<el-table-column
									label="邮箱"
									:show-overflow-tooltip="true"
									prop="email">
									</el-table-column>
								</el-table>
								<div class="page">
									<el-pagination
									background
									layout="prev, pager, next"
									:page-size="tableData.size"
									:page-count="tableData.totalPage"
									:current-page="searchObject.no"
									:total="tableData.total"
									@current-change="tableDataChange">
									</el-pagination>
								</div>
							</el-col>
						</el-row>
					</div>
				</div>

				<!-- 修改部门名称 -->
				<el-dialog
				:title="modifydepartmentTitle"
				:visible.sync="modifydepartment"
				width="30%"
				:before-close="handleClose(modifydepartment)">
				<el-row :gutter="20">
					<el-col :span="18" :offset="2">
						<el-row>
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">部门名称：</span>
							</el-col>
							<el-col :span="18">
								<el-input size="small" v-model="departmentName"></el-input>
							</el-col>
						</el-row>
					</el-col>
				</el-row>
				<span slot="footer" class="dialog-footer">
					<el-button size="small" @click="modifydepartment = false">取 消</el-button>
					<el-button size="small" type="primary" @click="addDepartment">确 定</el-button>
				</span>
				</el-dialog>

				<!-- 批量导入 -->
				<el-dialog
				title="批量导入"
				:visible.sync="batchImport"
				width="40%"
				:before-close="handleClose(batchImport)">
				<el-row :gutter="20">
					<el-col :span="16" :offset="4">
						<el-upload
						class="personnelUpload"
						drag
						action="https://jsonplaceholder.typicode.com/posts/"
						multiple
						:on-success="personnelListUploadSuccess">
						<i class="el-icon-upload"></i>
						<div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>
						</el-upload>
					</el-col>
				</el-row>
				<span slot="footer" class="dialog-footer">
					<el-button size="small" @click="batchImport = false">取 消</el-button>
					<el-button size="small" type="primary" @click="batchImport = false">确 定</el-button>
				</span>
				</el-dialog>

				<!-- 新增成员 -->
				<el-dialog
				:title="addMember.title"
				:visible.sync="addMember.state"
				width="40%"
				:before-close="handleClose(addMember.state)">
				<el-row :gutter="20">
					<el-col :span="18" :offset="2">
						<el-row style="margin-top: 20px;">
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">* 姓名：</span>
							</el-col>
							<el-col :span="18">
								<el-input size="small" placeholder="姓名" v-model="addMember.name"></el-input>
							</el-col>
						</el-row>
						<el-row style="margin-top: 20px;">
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">邮箱：</span>
							</el-col>
							<el-col :span="18">
								<el-input size="small" placeholder="邮箱" v-model="addMember.email"></el-input>
							</el-col>
						</el-row>
						<el-row style="margin-top: 20px;">
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">手机号：</span>
							</el-col>
							<el-col :span="18">
								<el-input size="small" placeholder="手机号" v-model="addMember.phone"></el-input>
							</el-col>
						</el-row>
						<el-row style="margin-top: 20px;" v-if="addMember.title == '新增成员'">
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">* 账户：</span>
							</el-col>
							<el-col :span="18">
								<el-input size="small" placeholder="账户" v-model="addMember.no"></el-input>
							</el-col>
						</el-row>
						<el-row style="margin-top: 20px;" v-if="addMember.title == '新增成员'">
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">密码：</span>
							</el-col>
							<el-col :span="18">
								<el-input type="password" size="small" placeholder="密码" v-model="addMember.password"></el-input>
							</el-col>
						</el-row>
						<el-row style="margin-top: 20px;">
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">性别：</span>
							</el-col>
							<el-col :span="18" style="line-height: 32px;">
								<el-radio size="small" v-model="addMember.gender" label="1">男</el-radio>
  								<el-radio size="small" v-model="addMember.gender" label="2">女</el-radio>
							</el-col>
						</el-row>
						<el-row style="margin-top: 20px;">
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">职务：</span>
							</el-col>
							<el-col :span="18">
								<el-input size="small" placeholder="职务" v-model="addMember.job"></el-input>
							</el-col>
						</el-row>
						<el-row style="margin-top: 20px;">
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">身份：</span>
							</el-col>
							<el-col :span="18" style="line-height: 32px;">
								<el-radio size="small" v-model="addMember.identity" label="1">普通成员</el-radio>
  								<el-radio size="small" v-model="addMember.identity" label="2">上级</el-radio>
							</el-col>
						</el-row>
						<el-row style="margin-top: 20px;">
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">* 部门：</span>
							</el-col>
							<el-col :span="18" style="line-height: 32px;">
								<el-cascader
									size="small"
									v-model="addMember.departments"
									:options="departmentOptions"
									:props="defaultProps"
									@change="handleChange">
								</el-cascader>
							</el-col>
						</el-row>
						<el-row style="margin-top: 20px;">
							<el-col :span="6">
								<span style="line-height: 32px;float: right;font-size: 12px;" class="el-form-item__label">* 标签：</span>
							</el-col>
							<el-col :span="18" style="line-height: 32px;">
								<el-select size="small" v-model="addMember.label" multiple placeholder="请选择标签">
									<el-option
									  v-for="item in labelOptions"
									  :key="item.value"
									  :label="item.label"
									  :value="item.value">
									</el-option>
								</el-select>
							</el-col>
						</el-row>
					</el-col>
				</el-row>
				<span slot="footer" class="dialog-footer" v-if="addMember.title == '新增成员'">
					<el-button size="small" type="primary" @click="createEmployee(true)">保存并继续添加</el-button>
					<el-button size="small" @click="createEmployee(false)">确 定</el-button>
					<el-button size="small" @click="addMember.state = false">取 消</el-button>
				</span>
				<span slot="footer" class="dialog-footer" v-else>
					<el-button size="small" @click="modifyPersonnelInfo">保存</el-button>
					<el-button size="small" @click="addMember.state = false">取 消</el-button>
				</span>
				</el-dialog>

				<!-- 设置部门 -->
				<el-dialog
				class="departmentDialog"
				title="设置成员所在部门"
				:visible.sync="department.state"
				width="40%"
				:before-close="handleClose(department.state)">
				<el-row>
					<el-col :span="15" style="border-right: 1px solid #F1F1F1;height: 100%;">
						<el-input
						style="width: 95%;"
						size="small"
						placeholder="搜索"
						v-model="filterText">
						</el-input>
						<el-tree style="margin-top: 10px;" ref="tree" :filter-node-method="filterNode" node-key="id" :default-expanded-keys="[1]" :check-strictly="true" :show-checkbox="true" draggable :data="data" :props="defaultProps" @check-change="handleNodeClick"></el-tree>
					</el-col>
					<el-col :span="9" style="padding: 0 20px;">
						<div class="title">成员将属于以下部门：</div>
						<ul>
							<li v-for="(item, index) in department.selectedDepartment" :key="index">
								<span>{{item.name}}</span>
							</li>
						</ul>
					</el-col>
				</el-row>
				<span slot="footer" class="dialog-footer">
					<el-button size="small" @click="department.state = false;">确 定</el-button>
					<el-button size="small" @click="department.state = false;$refs.tree.setCheckedKeys([])">取 消</el-button>
				</span>
				</el-dialog>
				<!-- /.box -->
			</section>
			<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->

		[#include "/admin/common/footer.html"]

		<!-- Control Sidebar -->
		[#include "/admin/common/aside.html"]

		<!-- /.control-sidebar -->
		<!-- Add the sidebar's background. This div must be placed
         immediately after the control sidebar -->
		<div class="control-sidebar-bg"></div>
	</div>
	<!-- ./wrapper -->

	<!-- jQuery 2.2.3 -->
	<script src="${siteurl}plugins/jQuery/jquery-2.2.3.min.js"></script>
	<!-- Bootstrap 3.3.6 -->
	<script src="${siteurl}bootstrap/js/bootstrap.min.js"></script>
	<!-- SlimScroll -->
	<script src="${siteurl}plugins/slimScroll/jquery.slimscroll.min.js"></script>
	<!-- FastClick -->
	<script src="${siteurl}plugins/fastclick/fastclick.js"></script>
	<!-- AdminLTE App -->
	<script src="${siteurl}dist/js/adminlte.min.js"></script>
	<!-- AdminLTE for demo purposes -->
	<script src="${siteurl}dist/js/list.js"></script>

	<script src="${siteurl}plugins/bootstrap-zTree/bootstrap-treeview.min.js"></script>
	<script src="${siteurl}plugins/zTree_v3/js/jquery.ztree.core.min.js"></script>

	<script type="text/javascript">
		$(document).ready(function () {
			var contentWrapperHeight = $(".content-wrapper").height();
			var contentWrapperWidth = $(".content-wrapper").width();
			var navigationHeight = $(".navigation").height();
			var mainHeaderHeight = $(".main-header").height();
			var mainFooterHeight = $(".main-footer").height();
			var mainFooterPaddingTop = $(".main-footer").css("padding-top");
			var mainFooterPaddingBottom = $(".main-footer").css("padding-bottom");
			var height = contentWrapperHeight - navigationHeight - mainHeaderHeight - mainFooterHeight - parseInt(mainFooterPaddingTop) - parseInt(mainFooterPaddingBottom) - 31;
			console.log(contentWrapperHeight, navigationHeight, mainHeaderHeight, mainFooterHeight, mainFooterPaddingTop, mainFooterPaddingBottom);
			//$(".goods").height(height);
		});
	</script>

	<!-- import Vue before Element -->
	<script src="${siteurl}plugins/vue-element/vue.js"></script>
	<!-- import JavaScript -->
	<script src="${siteurl}plugins/vue-element/element.js"></script>

	<script>
	    var labels=[{value: '选项1',
						label: '高管'
						}];
		var departments=[@departmentJson /]
		departments = departments ? departments: [];
		var vm = new Vue({
			el: '#app',
			data: function () {
				return {
					visible: false,
					filterText: '',
					departmentOptions: departments,
					labelOptions:labels,
					department: {
						state: false,
						filterText: '',
						selectedDepartment: []
					},
					addMember: {
						title: '新增成员',
						state: false,
						gender: '1',
						identity: '1',
						department: '',
						departments: '',
						name:'',
						no:'',
						password:'',
						email:'',
						job:'',
						phone:'',
						label: ''
					},
					searchObject:{
						no:1,
						size:10,
						department:''
					},
					batchImport: false,
					modifydepartment: false,
					modifydepartmentTitle: '',
					departmentName: '',
					parentId: '',
					data:departments,
					defaultProps: {
					children: 'child',
					label: 'name',
					value:'id'
					},
					tableData: {},
					multipleSelection: []
				}
			},
			created(){
				this.$nextTick(function(){
					this.$refs.tree.setCurrentKey(this.parentId);
				})
			},
			mounted: function () {
				this.getPersonnel(1)
			},
			watch: {
				filterText(val) {
					console.log(val);
					this.$refs.tree.filter(val);
				}
			},
			methods: {
				// 修改人员信息
				modifyPersonnelInfo() {
					var that=this, data = that.addMember;
					if(that.addMember.departments!=null&&that.addMember.departments.length>0){
					that.addMember.department=that.addMember.departments.pop();
					}
					$.post("${siteurl}tenantRest/employee/update.htm",data,function(res){
                       if(res.code==0){
						   that.getPersonnel(that.tableData.no);
						that.$message({
						message: '修改成功',
						type: 'success'
						});
						that.addMember.state=false;
					   }else{
						that.$message.error(''+res.msg);
					   }
					}); 
				},
				// 修改人员信息
				modifyPersonnel(event) {
					console.log(event);
					var that = this;
					this.addMember.title = '修改成员';
					this.addMember.state = true;
					this.tableData.list.forEach((item, index) => {
						if(item.id == event.id) {
							that.addMember.id = item.id;
							that.addMember.name = item.name;
							that.addMember.email = item.email;
							that.addMember.phone = item.phone;
							that.addMember.no = item.no;
							that.addMember.password = item.password;
							that.addMember.gender = item.gender;
							that.addMember.job = item.job;
							that.addMember.identity = item.identity;
							that.addMember.department = item.department;
							that.addMember.label = item.label;
						}
					})
				},
				// 人员分页
				tableDataChange(index) {
					this.searchObject.no=index;
					this.getPersonnel()
				},
				handleChange(value) {
					console.log(value);
				},
				// 获取人员名单
				getPersonnel(index) {
					var that = this;

					$.ajax({url:"${siteurl}tenantRest/employee/search.htm", data: that.searchObject, success:function(result){
						console.log(result);
						if(result.code == 0) {
							that.tableData = result;
							that.searchObject.no=result.no;
						}
					}});
				},
				// 人员名单上传成功
				personnelListUploadSuccess(file, fileList) {
					console.log(file, fileList);
				},
				// 删除人员
				delectPersonnel() {
					if(this.multipleSelection.length > 0) {
						console.log('删除人员');
					} else {
						this.$message({
							message: '请选择人员',
							type: 'warning'
						});
					}
				},
				// 启用安全登录
				enableSecurityLogin() {
					if(this.multipleSelection.length > 0) {
						console.log('启用安全登录');
					} else {
						this.$message({
							message: '请选择人员',
							type: 'warning'
						});
					}
				},
				// 启用人员
				enablePersonnel() {
					if(this.multipleSelection.length > 0) {
						console.log('启用人员');
					} else {
						this.$message({
							message: '请选择人员',
							type: 'warning'
						});
					}
				},
				// 禁用人员
				disablePersonnel() {
					if(this.multipleSelection.length > 0) {
						console.log('禁用人员');
					} else {
						this.$message({
							message: '请选择人员',
							type: 'warning'
						});
					}
				},
				// 设置所在部门
				setUpDepartment() {
					if(this.multipleSelection.length > 0) {
						this.department.state = true;
					} else {
						this.$message({
							message: '请选择人员',
							type: 'warning'
						});
					}
				},
				// 获取选中人员
				handleSelectionChange(val) {
					console.log(val);
					this.multipleSelection = val;
				},
				// 删除部门
				delectDepartment(id) {
					console.log(id);
					var that = this;
					$.ajax({url:"${siteurl}tenantRest/department/delete.htm",data: {id},success:function(result){
						console.log(result);
						if(result.code == 0) {
							that.$message({
								message: '恭喜你，删除部门成功',
								type: 'success'
							});
							that.refreshDepartment();
						} else {
							that.$message.error('删除部门失败');
						}
					}});
				},
				// 记录选中部门ID
				chooseDepartment(data) {
					this.parentId = data.id;
					this.searchObject.department=data.id;
					this.searchObject.no=1;
					this.getPersonnel();
				},
				// 添加部门和修改部门名称
				addDepartment() {
					var that = this;
					if(this.modifydepartmentTitle == "编辑部门" && this.parentId != "") {
						$.ajax({url:"${siteurl}tenantRest/department/update.htm",data: {name: this.departmentName,id: this.parentId},success:function(result){
							console.log(result);
							if(result.code == 0) {
								that.$message({
									message: '恭喜你，修改部门名称成功',
									type: 'success'
								});
								that.refreshDepartment();
							} else {
								that.$message.error('修改部门名称失败');
							}
							that.modifydepartment = false;
						}});
					} else if (this.modifydepartmentTitle == "编辑部门" && this.parentId == "") {
						this.$message({
							message: '请选择修改的部门',
							type: 'warning'
						});
					} else if(this.modifydepartmentTitle == "新建部门" && this.departmentName != "") {
						$.ajax({url:"${siteurl}tenantRest/department/create.htm",data: {name: this.departmentName,parent: this.parentId},success:function(result){
							console.log(result);
							if(result.code == 0) {
								that.$message({
									message: '恭喜你，新建部门成功',
									type: 'success'
								});
								that.refreshDepartment();
							} else {
								that.$message.error('新建部门失败');
							}
							that.modifydepartment = false;
						}});
					} else if(this.departmentName == "") {
						this.$message({
							message: '请输入部门名称',
							type: 'warning'
						});
					}
					this.departmentName = "";
				},
				// 刷新部门列表
				refreshDepartment() {
					var that = this;
					$.ajax({url:"${siteurl}tenantRest/department/company.htm",success:function(result){
						console.log(result);
						if(result.code == 0) {
							that.data = result.list;
							that.departmentOptions = result.list;
						}
					}});
				},
				// 关闭弹出框
				handleClose(event) {
					this[event] = false;
				},
				// 搜索部门
				filterNode(value, data) {
					if (!value) return true;
					return data.name.indexOf(value) !== -1;
				},
				handleSelect(key, keyPath) {
					console.log(key, keyPath);
				},
				createEmployee(state){
					var self=this;
					if(self.addMember.departments!=null&&self.addMember.departments.length>0){
					   self.addMember.department=self.addMember.departments.pop();
					}
					var params=JSON.stringify(this.addMember);
                      console.info(params);
					$.post("${siteurl}tenantRest/employee/create.htm",self.addMember,function(res){
                       if(res.code==0){
                          if(state){
                            self.$message.success('添加员工成功');
						  }else{
                            self.addMember.state=false;
						  }
					   }else{
						self.$message.error(''+res.msg);
					   }
					   self.getPersonnel(self.tableData.no);
					}); 
				},
				// 选中部门
				handleNodeClick(data) {
					console.log(data);
					var selectedDepartment = this.department.selectedDepartment, flag = false;
					selectedDepartment.forEach((item, index) => {
						console.log(item.id == data.id || flag)
						if(item.id == data.id) {
							flag = true;
							this.department.selectedDepartment.splice(index, 1);
						} else if(!flag) {
							flag = false
						}
					})
					if(!flag) {
						this.department.selectedDepartment.push({id: data.id,name: data.name});
					}
				}
			}
		})
	</script>

</body>

</html>